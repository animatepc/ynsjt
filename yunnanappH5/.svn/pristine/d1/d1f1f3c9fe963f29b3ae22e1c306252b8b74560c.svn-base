<template>
    <div class="home">
        <tab
            active-color="#fc2506"
            bar-active-color="#fc2506"
            :animate="false"
            :line-width="1">
                <tab-item
                v-for="(item,keys) in tabArr"
                :selected="keys == index"
                :key="keys"
                @click.native="handler(keys)"><span>{{item.tabName}}</span></tab-item>
        </tab>
         <div class="home_content color28" v-for="(item,keys) in tabArr" :key="keys" v-show="keys == index">
            <scroller
                :lock-x="true"
                :scrollbarY="true"
                :bounce="true"
                :use-pulldown="true"
                :use-pullup="true"
                :pulldown-config="{downContent: '下拉刷新', upContent: '释放后更新'}"
                :pullup-config="{upContent:'上拉加载更多', downContent: '释放后加载'}"
                ref="myScroller"
                :scroll-bottom-offset="40"
                 @on-pulldown-loading="pageNo = 1;getArticleList(1)"
                 @on-pullup-loading="getArticleList(1)"
                style="height: calc(100vh - 1.28rem - 44px - .98rem)"
                >
                <!-- <scroller v-show="isShow" v-model="scrollerStatus" lock-x scrollbar-y ref="scroller" :bounce="isbounce"
              :use-pullup="showUp" :pullup-config="upobj" @on-pullup-loading="selPullUp" style="height: calc(100vh - 1.28rem - 44px - .98rem)"> -->
                <ul class="home_list _cus_overHidden">
                    <li v-for="(item,key) in news_List" :key="keys" class="_cus_flexContent">
                        <div class="_cus_overHidden __cus_fl _cus_flex1 _cus_posRelative" >
                            <span v-show="item.tab" class="source-handle-title">{{item.tab}}</span>
                            <label class="source-label">{{item.label}}</label>
                            <div class="tabImg" v-show="item.type =='tab' || item.type =='tab_video'" :class="item.type=='tablist'?'_cus_posRelative':''">
                                <img class="" :src="item.price" alt="">
                                <i class="video_playicon" v-show="item.type =='tab_video'"></i>
                            </div>
                            
                            <p class="home_time _cus_overHidden color999" :class="item.type =='tablist'?'_cus_posAbsolute perW100':''">
                                <span class="__cus_fl">
                                    <span>{{item.soure}}</span>
                                    <span class="">{{item.timer}}</span>
                                    
                                </span>
                                <span class="__cus_fr">
                                    <span>{{item.watch_num}}</span>
                                    <span class="new_watch"></span>
                                </span>
                            </p>
                        </div>
                        <div v-show="item.type == 'tablist'" class="_cus_overHidden __cus_fr imageNews-img">
                            <img :src="item.price" alt="">
                            
                        </div>
                    </li>
                    <li>31132</li>
                    <li>31132</li>
                    <li>31132</li>
                    <li>31132</li>
                    <li>31132</li>
                    <li>31132</li>
                    <li>31132</li>
                    <li>31132</li>
                    <li>31132</li>  
                </ul>
            </scroller>
        </div>
    </div>
</template>
<script>
import { gloabApi } from '../../services/gloabapi.js'
import {HttpService} from "../../services/http";
    export default {
        data(){
            return {
                 tabArr:[
                    {'tabName':'云南省'},
                    {'tabName':'热点'},
                    {'tabName':'新时代'},
                    {'tabName':'直播'}
                ],
                news_List:[
                    {'label':'对仗不工整上下联挂反 昆明老街多幅对联被指“没文化','soure':'昆明信息港','timer':'1天前','watch_num':30,'type':'list'},
                    {'label':'滇池大坝12组新建景观雕塑全部完工 正式与市民见面','soure':'春城晚报','timer':'1天前','watch_num':4,'type':'list'},
                    {'label':'昆明市将实施献血条例：献血满5次终生免交临床用血费','soure':'春城晚报','timer':'1天前','watch_num':4,'type':'list'},
                    {'label':'昆明今后违法排污将面临最高50万元罚款','soure':'春城晚报','timer':'1天前','watch_num':4,'type':'list'},
                    {'label':'最美云南 秘境百马','price':'../../static/imgs/contentimg.jpg','tab':'专题','timer':'2天前','type':'tab'},
                    {'label':'名声关注','price':'../../static/imgs/contentimg.jpg','watch_num':158,'timer':'2天前','type':'tablist'},
                    {'label':'客车追尾大货车 男子被困消防营救','price':'../../static/imgs/contentimg.jpg','watch_num':85,'timer':'2天前','type':'tab_video'}
                ],
                index:0,

                type: '1',
                PageIndex: 1,//页码从第一页开始
                PageSize: 5,//煤业显示的条数
                isShow: true,//是否显示scroller,第一次请求数据过程中隐藏插件，不隐藏的时候会显示“请上拉刷新数据”的字样，不好看
                showloading: false,
                textloading: '加载中',
                showUp: true,
                isbounce: false,
                lists: [],
                upobj: {
                content: '请上拉刷新数据',
                pullUpHeight: 60,
                height: 40,
                autoRefresh: false,
                downContent: '请上拉刷新数据',
                upContent: '请上拉刷新数据',
                loadingContent: '加载中...',
                clsPrefix: 'xs-plugin-pullup-'
                },
                isShowLoading: false,
                textLoading: '加载中',
                scrollerStatus: {
                pullupStatus: 'default'
                }
            }
        },
         mounted () {
        //第一次加载
        this.getNewsList(true)
        this.$nextTick(() => {
            this.$refs.scroller.reset()
        })
    },
    methods: {
        //第一次加载的时候容易为空true
        getNewsList (isEmpty) {
            this.showloading = true
            let JsonApi = {
                callback: 'onBack',
                i: this.PageIndex,
                title: '',
                columnCode: '', 
                cityCode: 530100,
                provCode: '',
                _: 1527761696303
            }
    　　　　gloabApi.contentList(JsonApi).then(response,txt => {
            // sucess callback
            console.log(response)
                var data = [];
                if (isEmpty) {
                    this.lists = []
                    this.show = false
                } else {
                    //isEmpty为false时，也就是向上滚动刷新selPullUp ()方法被被调用的时候
                    if (data && data.length === 0) {
                    this.showToast = true
                    this.isShowLoading = false
                    this.scrollerStatus.pullupStatus = 'disabled' // 禁用下拉
                    return
                    }
                }
                for (var i = 0; i < data.length; i++) {
                    this.lists.push(data[i]);
                }
                this.isShow = true;
                this.showloading = false
                if (!isEmpty) {
                    this.scrollerStatus.pullupStatus = 'default'
                    this.$nextTick(() => {
                    this.$refs.scroller.reset()
                    })
                }
                }, response => {
                // error callback
                this.isShow = false
                })
            },
            selPullUp () {
                this.PageIndex++      
                this.getNewsList(false)
            },
            activated () {
                this.$refs.scroller.reset()
            },
            // 
            getArticleList(){

            },
            handler(keys){
                this.index = keys
            }
        } 
    }
</script>
<style lang="less">
    .home{
        .home_content{
            .home_list{
                >li{
                    padding: 0.2rem 0.3rem;
                    overflow: hidden;
                    border-bottom: 1px solid #eeeeee;
                    .source-handle-title{
                        margin-right: 0.15rem;
                        margin-top: 0.033rem;
                        float: left;
                        color: #f41a14;
                        border: 1px solid #f41a14;
                        text-align: center;
                        line-height: 1.5;
                        padding: 0 0.1rem;
                        font-size: 0.24rem;
                        border-radius: 0.1rem;
                    }
                    .source-label{
                            display: -webkit-box;
                            -webkit-box-orient: vertical;
                            -webkit-line-clamp: 2;
                            overflow: hidden;
                            text-align: justify;
                            line-height: 0.48rem;
                    }
                    .tabImg{
                        width: 100%;
                        height: 3.4rem;
                        margin-top: 0.1rem;
                        margin-bottom: 0.3rem;
                        >img{
                            vertical-align: middle;
                            width: 100%;
                            height: 100%;
                            z-index: 1;
                        }
                        >.video_playicon{
                            width: 1.06rem;
                            height: 1.06rem;
                            position: absolute;
                            top: 50%;
                            left: 50%;
                            margin-top: -0.58rem;
                            margin-left: -0.58rem;
                            background: url(../../../static/imgs/playicon.png) no-repeat left center;
                            background-size: 100%;
                            z-index:2;
                        }
                    }
                    .home_time{
                        bottom: 0;
                        margin-top:.3rem;
                        font-size:.20rem;
                        .new_watch{
                            margin-left: .15rem;
                                width: .29rem;
                                height: .2rem;
                                display: inline-block;
                                background: url(../../../static/imgs/eye.png) no-repeat left center;
                                background-size: 100%;
                        }
                    }
                    .imageNews-img{
                        width: 2.2rem;
                        height: 1.44rem;
                        margin-left: 0.2rem;
                        >img{
                            width: 100%;
                            height: 100%;
                        }
                    }
                }
            }
        }
    }
</style>

